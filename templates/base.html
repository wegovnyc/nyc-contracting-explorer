<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Open Contracting Explorer</title>

  <!-- NYC Core Framework (Bootstrap 4 based) -->
  <link href="{{ url_for('static', filename='css/theme.css') }}" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
    }

    .table-hover tbody tr:hover {
      background-color: #f5f5f5;
      cursor: pointer;
    }

    /* NYC Branding Tweaks if needed */
    .navbar-brand {
      font-weight: bold;
    }

    /* Missing Breadcrumb Styles */
    .breadcrumb {
      display: flex;
      flex-wrap: wrap;
      padding: 0.75rem 1rem;
      margin-bottom: 1rem;
      list-style: none;
      background-color: transparent;
      /* Cleaner look */
      border-radius: 0.25rem;
      padding-left: 0;
      /* Align with left edge */
    }

    .breadcrumb-item+.breadcrumb-item {
      padding-left: 0.5rem;
    }

    .breadcrumb-item+.breadcrumb-item::before {
      display: inline-block;
      padding-right: 0.5rem;
      color: #6c757d;
      content: "/";
    }

    .breadcrumb-item.active {
      color: #6c757d;
    }

    /* Tooltip overrides for better visibility */
    .tooltip-inner {
      background-color: white !important;
      color: black !important;
      border: 1px solid #ccc;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }

    .tooltip.bs-tooltip-top .arrow::before,
    .tooltip.bs-tooltip-auto[x-placement^="top"] .arrow::before {
      border-top-color: white !important;
    }

    /* Missing Bootstrap 4 Pagination Styles */
    .pagination {
      display: -ms-flexbox;
      display: flex;
      padding-left: 0;
      list-style: none;
      border-radius: .25rem;
    }

    .page-link {
      position: relative;
      display: block;
      padding: .5rem .75rem;
      margin-left: -1px;
      line-height: 1.25;
      color: #007bff;
      background-color: #fff;
      border: 1px solid #dee2e6;
    }

    .page-link:hover {
      z-index: 2;
      color: #0056b3;
      text-decoration: none;
      background-color: #e9ecef;
      border-color: #dee2e6;
    }

    .page-link:focus {
      z-index: 2;
      outline: 0;
      box-shadow: 0 0 0 .2rem rgba(0, 123, 255, .25);
    }

    .page-item:first-child .page-link {
      margin-left: 0;
      border-top-left-radius: .25rem;
      border-bottom-left-radius: .25rem;
    }

    .page-item:last-child .page-link {
      border-top-right-radius: .25rem;
      border-bottom-right-radius: .25rem;
    }

    .page-item.active .page-link {
      z-index: 1;
      color: #fff;
      background-color: #007bff;
      border-color: #007bff;
    }

    .page-item.disabled .page-link {
      color: #6c757d;
      pointer-events: none;
      cursor: auto;
      background-color: #fff;
      border-color: #dee2e6;
    }

    .pagination-lg .page-link {
      padding: .75rem 1.5rem;
      font-size: 1.25rem;
      line-height: 1.5;
    }

    .pagination-lg .page-item:first-child .page-link {
      border-top-left-radius: .3rem;
      border-bottom-left-radius: .3rem;
    }

    .pagination-lg .page-item:last-child .page-link {
      border-top-right-radius: .3rem;
      border-bottom-right-radius: .3rem;
    }

    .pagination-sm .page-link {
      padding: .25rem .5rem;
      font-size: .875rem;
      line-height: 1.5;
    }

    .pagination-sm .page-item:first-child .page-link {
      border-top-left-radius: .2rem;
      border-bottom-left-radius: .2rem;
    }

    .pagination-sm .page-item:last-child .page-link {
      border-top-right-radius: .2rem;
      border-bottom-right-radius: .2rem;
    }
  </style>
</head>

<body data-spy="scroll" data-target="#v-pills-tab" data-offset="100">
  <!-- WeGov Disclaimer Header -->
  <div
    style="background-color: var(--orange); color: white; font-size: 13px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; padding: 8px 0; font-weight: bold; text-align: center;">
    <div class="container">
      This is NOT a website of the City of New York. It is a website of WeGovNYC, a nonprofit project.
    </div>
  </div>

  <!-- Main Application Header -->
  <nav class="navbar navbar-dark sticky-top"
    style="background-color: var(--dark); color: white; border-top: 1px solid #333;">
    <div class="container d-flex justify-content-between align-items-center">
      <a class="navbar-brand font-weight-bold text-white" href="/"
        style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 20px; letter-spacing: 0.5px;">NYC
        Contract Explorer</a>

      <!-- Menu Items -->
      <div id="navbarMenu">
        <ul class="navbar-nav d-flex flex-row list-unstyled m-0"
          style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-weight: bold; font-size: 14px;">
          <li class="nav-item ml-4">
            <a class="nav-link text-white" href="/vendors">Vendors</a>
          </li>
          <li class="nav-item ml-4">
            <a class="nav-link text-white" href="/agencies">Agencies</a>
          </li>
          <li class="nav-item ml-4">
            <a class="nav-link text-white" href="/contracts">Contracts</a>
          </li>
          <li class="nav-item ml-4">
            <a class="nav-link text-white" href="/solicitations">Solicitations</a>
          </li>
          <li class="nav-item ml-4">
            <a class="nav-link text-white" href="/transactions">Transactions</a>
          </li>
          <li class="nav-item ml-4">
            <a class="nav-link text-white" href="/about" style="opacity: 0.8;">About</a>
          </li>

        </ul>
      </div>
    </div>
  </nav>

  <main class="container mt-2">
    {% block content %}{% endblock %}
  </main>

  <!-- WeGov Footer -->
  <footer style="background-color: var(--light); padding-top: 40px; margin-top: 50px; border-top: 1px solid #e9ecef;">
    <div class="container">
      <div class="row">

      </div>
      <div class="row">
        <div class="col-md-3">
          <h6 class="font-weight-bold text-uppercase mb-3" style="font-size: 0.9rem;">Sections</h6>
          <ul class="list-unstyled" style="font-size: 0.9rem;">
            <li><a href="//wegov.nyc/news-events/" target="_blank" class="text-secondary">News & Events</a></li>
            <li><a href="//wegov.nyc/tools/" target="_blank" class="text-secondary">Tools</a></li>
          </ul>
        </div>
        <div class="col-md-3">
          <h6 class="font-weight-bold text-uppercase mb-3" style="font-size: 0.9rem;">Contribute</h6>
          <ul class="list-unstyled" style="font-size: 0.9rem;">
            <li><a href="https://www.notion.so/wegovnyc/Get-Involved-d31cee2e3ea04051b600e0a5b902daab" target="_blank"
                class="text-secondary">Get Involved</a></li>
            <li><a href="https://opencollective.com/wegovnyc" target="_blank" class="text-secondary">Donate</a></li>
          </ul>
        </div>
        <div class="col-md-3">
          <h6 class="font-weight-bold text-uppercase mb-3" style="font-size: 0.9rem;">About</h6>
          <ul class="list-unstyled" style="font-size: 0.9rem;">
            <li><a href="https://wegov.nyc/about/" target="_blank" class="text-secondary">WeGovNYC</a></li>
            <li><a href="http://sarapis.org/about" target="_blank" class="text-secondary">Sarapis</a></li>
          </ul>
        </div>
        <div class="col-md-3">
          <h6 class="font-weight-bold text-uppercase mb-3" style="font-size: 0.9rem;">Social</h6>
          <ul class="list-unstyled" style="font-size: 0.9rem;">
            <li><a href="https://twitter.com/wegovnyc" target="_blank" class="text-secondary">Twitter</a></li>
            <li><a href="https://www.facebook.com/wegovnyc" target="_blank" class="text-secondary">Facebook</a></li>
            <li><a href="https://github.com/wegovnyc" target="_blank" class="text-secondary">GitHub</a></li>
          </ul>
        </div>
      </div>
    </div>

    <!-- WeGov Bottom Footer -->
    <div style="background-color: var(--dark); color: #fff; padding: 20px 0; margin-top: 40px;">
      <div class="container text-center">
        <p class="mb-1">
          <a href="https://databook.nyc" class="text-white font-weight-bold">WeGovNYC</a> is a project of <a
            href="https://sarapis.org/" target="_blank" class="text-white">Sarapis</a>, a 501.c.3 nonprofit.
        </p>
        <p class="mb-0 text-muted small">
          <a href="#" class="text-muted pr-2">CC</a>
          <a href="#" class="text-muted pr-2">BY</a>
          <a href="#" class="text-muted">SA</a>
        </p>
      </div>
    </div>
  </footer>

  <!-- Dependencies for Bootstrap 4 -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- NYC Core Framework JS -->
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>

  <script>
    // Make rows clickable if they have data-href
    document.addEventListener("DOMContentLoaded", () => {
      const rows = document.querySelectorAll("tr[data-href]");
      rows.forEach(row => {
        row.addEventListener("click", () => {
          window.location.href = row.dataset.href;
        });
      });
    });
  </script>
  {% block scripts %}{% endblock %}

  <!-- Chat Widget -->
  <style>
    #chatbot-widget {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 9999;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    #chatbot-toggle {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: linear-gradient(135deg, #F5A623 0%, #D4790E 100%);
      border: 3px solid white;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(212, 121, 14, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      overflow: hidden;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    #chatbot-toggle:hover {
      transform: scale(1.08);
      box-shadow: 0 6px 20px rgba(212, 121, 14, 0.5);
    }

    #chatbot-toggle img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    #chatbot-window {
      display: none;
      position: absolute;
      bottom: 70px;
      right: 0;
      width: 380px;
      height: 500px;
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      flex-direction: column;
      overflow: hidden;
    }

    #chatbot-window.open {
      display: flex;
    }

    #chatbot-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 16px;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #chatbot-header button {
      background: none;
      border: none;
      color: white;
      font-size: 20px;
      cursor: pointer;
      opacity: 0.8;
    }

    #chatbot-header button:hover {
      opacity: 1;
    }

    #chatbot-messages {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      background: #f8f9fa;
    }

    .chat-message {
      margin-bottom: 12px;
      max-width: 85%;
    }

    .chat-message.user {
      margin-left: auto;
    }

    .chat-message .bubble {
      padding: 10px 14px;
      border-radius: 16px;
      font-size: 14px;
      line-height: 1.4;
    }

    .chat-message.user .bubble {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-bottom-right-radius: 4px;
    }

    .chat-message.assistant .bubble {
      background: white;
      color: #333;
      border: 1px solid #e0e0e0;
      border-bottom-left-radius: 4px;
    }

    .chat-message.assistant .bubble strong {
      color: #667eea;
    }

    #chatbot-input-area {
      padding: 12px;
      border-top: 1px solid #e0e0e0;
      background: white;
      display: flex;
      gap: 8px;
    }

    #chatbot-input {
      flex: 1;
      padding: 10px 14px;
      border: 1px solid #e0e0e0;
      border-radius: 20px;
      font-size: 14px;
      outline: none;
    }

    #chatbot-input:focus {
      border-color: #667eea;
    }

    #chatbot-send {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #chatbot-send:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    #chatbot-send svg {
      width: 18px;
      height: 18px;
      fill: white;
    }

    .typing-indicator {
      display: flex;
      gap: 4px;
      padding: 10px 14px;
    }

    .typing-indicator span {
      width: 8px;
      height: 8px;
      background: #667eea;
      border-radius: 50%;
      animation: typing 1.4s ease-in-out infinite;
    }

    .typing-indicator span:nth-child(2) {
      animation-delay: 0.2s;
    }

    .typing-indicator span:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes typing {

      0%,
      60%,
      100% {
        transform: translateY(0);
      }

      30% {
        transform: translateY(-8px);
      }
    }

    /* Chart action buttons */
    .chart-actions {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      justify-content: flex-end;
    }

    .chart-actions button {
      padding: 4px 10px;
      font-size: 11px;
      border-radius: 4px;
      border: 1px solid #667eea;
      background: white;
      color: #667eea;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: all 0.2s;
    }

    .chart-actions button:hover {
      background: #667eea;
      color: white;
    }

    .chart-actions button svg {
      width: 12px;
      height: 12px;
      fill: currentColor;
    }

    /* Chart Modal */
    #chart-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 10000;
      justify-content: center;
      align-items: center;
    }

    #chart-modal.open {
      display: flex;
    }

    #chart-modal-content {
      background: white;
      border-radius: 12px;
      width: 90%;
      max-width: 900px;
      max-height: 90%;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    #chart-modal-header {
      padding: 16px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
    }

    #chart-modal-header button {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      line-height: 1;
    }

    #chart-modal-body {
      padding: 20px;
      flex: 1;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #chart-modal-body canvas {
      max-width: 100%;
      max-height: 60vh;
    }

    #chart-modal-actions {
      padding: 16px 20px;
      border-top: 1px solid #eee;
      display: flex;
      gap: 12px;
      justify-content: flex-end;
    }

    #chart-modal-actions button {
      padding: 10px 20px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    #chart-modal-actions .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    #chart-modal-actions .btn-secondary {
      background: #f0f0f0;
      color: #333;
    }
  </style>

  <div id="chatbot-widget">
    <div id="chatbot-window">
      <div id="chatbot-header">
        <span><img src="{{ url_for('static', filename='img/chat-squirrel.png') }}" alt=""
            style="width: 24px; height: 24px; border-radius: 50%; vertical-align: middle; margin-right: 8px;">Ask about
          NYC Procurement</span>
        <button onclick="toggleChat()" title="Close">&times;</button>
      </div>
      <div id="chatbot-messages">
        <div class="chat-message assistant">
          <div class="bubble">
            Hi! I can help you explore NYC procurement data. Try asking:
            <br><br>
            • "What was total spending in FY2024?"<br>
            • "Search for ACCENTURE contracts"<br>
            • "Show NYPD solicitations"
          </div>
        </div>
      </div>
      <div id="chatbot-input-area">
        <input type="text" id="chatbot-input" placeholder="Ask about vendors, contracts, spending..."
          onkeypress="if(event.key==='Enter')sendChat()">
        <button id="chatbot-send" onclick="sendChat()">
          <svg viewBox="0 0 24 24">
            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
          </svg>
        </button>
      </div>
    </div>
    <button id="chatbot-toggle" onclick="toggleChat()" title="Chat with AI">
      <img src="{{ url_for('static', filename='img/chat-squirrel.png') }}" alt="Chat">
    </button>
  </div>

  <!-- Chart Modal -->
  <div id="chart-modal" onclick="if(event.target===this)closeChartModal()">
    <div id="chart-modal-content">
      <div id="chart-modal-header">
        <span id="chart-modal-title">Chart View</span>
        <button onclick="closeChartModal()">&times;</button>
      </div>
      <div id="chart-modal-body">
        <canvas id="modal-chart-canvas"></canvas>
      </div>
      <div id="chart-modal-actions">
        <button class="btn-secondary" onclick="closeChartModal()">Close</button>
        <button class="btn-primary" onclick="downloadModalChart()">
          <svg viewBox="0 0 24 24" width="16" height="16">
            <path fill="currentColor" d="M5 20h14v-2H5v2zM19 9h-4V3H9v6H5l7 7 7-7z" />
          </svg>
          Download PNG
        </button>
      </div>
    </div>
  </div>

  <script>
    const chatHistory = [];
    let currentModalChartConfig = null;
    let modalChart = null;

    function toggleChat() {
      const window = document.getElementById('chatbot-window');
      window.classList.toggle('open');
      if (window.classList.contains('open')) {
        document.getElementById('chatbot-input').focus();
      }
    }

    function openChartModal(chartConfigStr, title) {
      currentModalChartConfig = JSON.parse(chartConfigStr);
      const modal = document.getElementById('chart-modal');
      const canvas = document.getElementById('modal-chart-canvas');
      const titleEl = document.getElementById('chart-modal-title');

      // Get title from chart config or use default
      titleEl.textContent = currentModalChartConfig.options?.plugins?.title?.text || title || 'Chart View';

      // Destroy existing chart if any
      if (modalChart) {
        modalChart.destroy();
      }

      // Create new chart
      modalChart = new Chart(canvas.getContext('2d'), currentModalChartConfig);
      modal.classList.add('open');
      document.body.style.overflow = 'hidden';
    }

    function closeChartModal() {
      const modal = document.getElementById('chart-modal');
      modal.classList.remove('open');
      document.body.style.overflow = '';
      if (modalChart) {
        modalChart.destroy();
        modalChart = null;
      }
    }

    function downloadModalChart() {
      const canvas = document.getElementById('modal-chart-canvas');
      const link = document.createElement('a');
      link.download = 'nyc-procurement-chart.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    }

    function downloadChart(canvasId) {
      const canvas = document.getElementById(canvasId);
      const link = document.createElement('a');
      link.download = 'nyc-procurement-chart.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    }

    function addMessage(text, role) {
      const messages = document.getElementById('chatbot-messages');
      const div = document.createElement('div');
      div.className = `chat-message ${role}`;

      // Check for chart data
      const chartMatch = text.match(/__CHART__(.+?)__CHART__/s);

      if (chartMatch && role === 'assistant') {
        try {
          const chartConfig = JSON.parse(chartMatch[1]);
          const chartConfigStr = chartMatch[1];
          const textBefore = text.split('__CHART__')[0].trim();
          const textAfter = text.split('__CHART__').slice(2).join('').trim();
          const chartId = 'chart-' + Date.now();

          // Create bubble with text and chart
          let html = '<div class="bubble">';
          if (textBefore) {
            html += textBefore.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>') + '<br><br>';
          }
          html += '<canvas id="' + chartId + '" style="max-height: 250px; width: 100%;"></canvas>';
          html += '<div class="chart-actions">';
          html += '<button onclick="downloadChart(\'' + chartId + '\')" title="Download as PNG">';
          html += '<svg viewBox="0 0 24 24"><path d="M5 20h14v-2H5v2zM19 9h-4V3H9v6H5l7 7 7-7z"/></svg> Download';
          html += '</button>';
          html += '<button onclick="openChartModal(\'' + chartConfigStr.replace(/'/g, "\\'").replace(/"/g, '&quot;') + '\')" title="Open in full screen">';
          html += '<svg viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg> Expand';
          html += '</button>';
          html += '</div>';
          if (textAfter) {
            html += '<br>' + textAfter.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
          }
          html += '</div>';

          div.innerHTML = html;
          messages.appendChild(div);

          // Render chart
          const canvas = div.querySelector('canvas');
          new Chart(canvas.getContext('2d'), chartConfig);

        } catch (e) {
          console.error('Chart parsing error:', e);
          // Fall back to text display
          div.innerHTML = `<div class="bubble">${text.replace(/__CHART__.+?__CHART__/s, '[Chart data error]')}</div>`;
          messages.appendChild(div);
        }
      } else {
        // Regular message - simple markdown-like formatting
        let formatted = text
          .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
          .replace(/\n/g, '<br>');

        div.innerHTML = `<div class="bubble">${formatted}</div>`;
        messages.appendChild(div);
      }

      messages.scrollTop = messages.scrollHeight;
    }

    function showTyping() {
      const messages = document.getElementById('chatbot-messages');
      const div = document.createElement('div');
      div.className = 'chat-message assistant';
      div.id = 'typing-indicator';
      div.innerHTML = '<div class="bubble"><div class="typing-indicator"><span></span><span></span><span></span></div></div>';
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
    }

    function hideTyping() {
      const el = document.getElementById('typing-indicator');
      if (el) el.remove();
    }

    async function sendChat() {
      const input = document.getElementById('chatbot-input');
      const sendBtn = document.getElementById('chatbot-send');
      const message = input.value.trim();

      if (!message) return;

      // Add user message
      addMessage(message, 'user');
      chatHistory.push({ role: 'user', content: message });
      input.value = '';
      sendBtn.disabled = true;

      showTyping();

      try {
        const response = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message, history: chatHistory.slice(-10) })
        });

        hideTyping();

        if (!response.ok) {
          throw new Error('Chat request failed');
        }

        const data = await response.json();

        if (data.error) {
          addMessage('Sorry, something went wrong. Please try again.', 'assistant');
        } else {
          addMessage(data.response, 'assistant');
          chatHistory.push({ role: 'assistant', content: data.response });
        }
      } catch (error) {
        hideTyping();
        addMessage('Sorry, I couldn\'t connect. Please try again.', 'assistant');
        console.error('Chat error:', error);
      }

      sendBtn.disabled = false;
      input.focus();
    }
  </script>
</body>

</html>